<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<HTML
><HEAD
><TITLE
>Bitácoras</TITLE
><META
NAME="GENERATOR"
CONTENT="Modular DocBook HTML Stylesheet Version 1.79"><LINK
REL="HOME"
HREF="t1.htm"><LINK
REL="PREVIOUS"
TITLE="Labores básicas de administración"
HREF="x1661.htm"><LINK
REL="NEXT"
TITLE="Novedades"
HREF="a1852.htm"></HEAD
><BODY
CLASS="sect1"
BGCOLOR="#FFFFFF"
TEXT="#000000"
LINK="#0000FF"
VLINK="#840084"
ALINK="#0000FF"
><DIV
CLASS="NAVHEADER"
><TABLE
SUMMARY="Header navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TH
COLSPAN="3"
ALIGN="center"
></TH
></TR
><TR
><TD
WIDTH="10%"
ALIGN="left"
VALIGN="bottom"
><A
HREF="x1661.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="80%"
ALIGN="center"
VALIGN="bottom"
></TD
><TD
WIDTH="10%"
ALIGN="right"
VALIGN="bottom"
><A
HREF="a1852.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
></TABLE
><HR
ALIGN="LEFT"
WIDTH="100%"></DIV
><DIV
CLASS="sect1"
><H1
CLASS="sect1"
><A
NAME="bitacoras"
>Bitácoras</A
></H1
><P
>Una de las labores típicas de un administrador de un sistema OpenBSD
	  es revisar bitácoras del sistema en búsqueda de fallas de seguridad.
	  En la mayoría de las veces se trata de ataques a través de internet, 
	  ataques que buscan entre otras cosas: acceder a nuestras máquinas 
	  para sacar información y  modificarla, o usar nuestra máquina para que 
	  realice trabajos que el atacante quiere hacer, generalmente 
	  maliciosos.</P
><P
>&#13;	  OpenBSD deja un registro muy completo en archivos de 
	  <TT
CLASS="filename"
>/var/log</TT
> conocidas como bitácoras.  Algunas
	  son:
	  <P
></P
><UL
><LI
><P
><TT
CLASS="filename"
>authlog</TT
>: Muestra los 
				  accesos de los usuarios permitidos y 
				  rechazados
			  </P
></LI
><LI
><P
><TT
CLASS="filename"
>secure</TT
>:  Muestra los 
				  comandos de los administradores sudo
			  </P
></LI
><LI
><P
> <TT
CLASS="filename"
>daemon</TT
>:  Los programas 
				  que están corriendo en la máquina</P
></LI
></UL
>

	  Como el sistema hace rotación de bitácoras periódicamente, en el 
	  mismo directorio también se encuentra archivadas algunas bitácoras 
	  anteriores, comprimidas (terminan con nombres como
	  <TT
CLASS="filename"
>.0.gz</TT
>).
  </P
><P
>&#13;	  Estos
	  archivos pueden analizarse con algunas herramientas básicas como:
	  <P
></P
><DIV
CLASS="variablelist"
><DL
><DT
><B
CLASS="command"
>less</B
></DT
><DD
><P
>Examinar una archivo.  En <B
CLASS="command"
>less</B
> la tecla <B
CLASS="keycap"
>G</B
> (mayúscula) lo lleva al final
				  del archivo.</P
></DD
><DT
><B
CLASS="command"
>grep</B
></DT
><DD
><P
>Muestra cadenas en un archivo</P
></DD
><DT
><B
CLASS="command"
>find</B
></DT
><DD
><P
>Busca una cadena en un archivo o directorio</P
></DD
><DT
><B
CLASS="command"
>wc</B
></DT
><DD
><P
>Cuenta palabras/líneas/caracteres en una archivo</P
></DD
><DT
><B
CLASS="command"
>dig</B
></DT
><DD
><P
>Muestra información de un dominio</P
></DD
><DT
><B
CLASS="command"
>geoiplookup</B
></DT
><DD
><P
>Muestra localización de una IP. No es muy precisa</P
></DD
><DT
><B
CLASS="command"
>gzip</B
></DT
><DD
><P
>Descomprime archivos</P
></DD
></DL
></DIV
>
	  
</P
><P
>&#13;	A continuación un ejemplo de auditoria de la bitácora <TT
CLASS="filename"
>auth</TT
>:

<P
></P
><OL
TYPE="1"
><LI
><P
>Como usuario root (<A
HREF="x1661.htm"
>la sección de nombre <I
>Labores básicas de administración</I
></A
>) 
			hacer una copia de las bitácoras de 
			<TT
CLASS="filename"
>/var/log</TT
> en un directorio 
			personal y descomprimir bitácoras comprimidas.
			<PRE
CLASS="screen"
>&#13;cd
mkdir audita          # Crea un directorio para copiar
cd audita             # Pasa al directorio creado
mkdir 30sep2006       # Crear un directorio con la fecha
cd 30sep2006	      # Pasa al directorio creado
cp -rf /var/log/* .   # Copia todas las bitácoras (debe ser root)
gzip -d *.gz          # Descomprime bitácoras comprimidas
			</PRE
>
</P
></LI
><LI
><P
>Revisar la bitácora a fin de determinar puntos 
			críticos:
			<PRE
CLASS="screen"
>&#13;less authlog
			</PRE
>	
			buscando líneas como
			<PRE
CLASS="screen"
>&#13;invalid user test from 211.157.113.89
			</PRE
>
			que revelan intento desde una IP por ingresar como usuario <TT
CLASS="literal"
>test</TT
> (que no existe en el sistema).
		</P
></LI
><LI
><P
>Para ver las líneas en las que aparece una cadena en 
			especial, una IP por ejemplo puede usarse:
				<PRE
CLASS="screen"
>&#13;grep "211.157.113.89" authlog
				</PRE
>
				De forma que podemos ver datos importantes 
				relacionados con la IP como fecha y  hora.  En 
				el caso de <TT
CLASS="filename"
>auth</TT
> 
				la IP corresponde a direcciones desde donde se
				hacen intentos de ingreso).
		</P
></LI
><LI
><P
>Para mostrar cuántas veces está esa IP en ese archivo:
			<PRE
CLASS="screen"
>&#13;grep "211.157.113.89" authlog | wc -l
			</PRE
>
		</P
></LI
><LI
><P
>Para determinar en qué archivos de la bitácora 
			hay información de esta IP 
			<PRE
CLASS="screen"
>&#13;find . -exec grep -l "211.157.113.89" {} ';'
			</PRE
>
		</P
></LI
><LI
><P
>Para determinar ubicación geográfica de una IP y
			datos sobre el dominio asociado:
			<PRE
CLASS="screen"
>&#13;geoiplookup  211.157.113.89
dig -x 211.157.113.89
			</PRE
>
			El primero indica China, el segundo 
			<TT
CLASS="literal"
>mail.chinacomm.com.cn</TT
>. Con el
			segundo ya podemos buscar información sobre
			el registro DNS de <TT
CLASS="literal"
>chinacomm.com.cn</TT
>:
			<PRE
CLASS="screen"
>&#13;whois chinacomm.com.cn
			</PRE
>
			donde encontromos una dirección de correo:
			<TT
CLASS="literal"
>wjy@chncomm.com</TT
>
		</P
></LI
><LI
><P
>Si se ubica el dominio de la IP de donde proviene un 
			ataque, así como una dirección de correo, se 
			recomienda enviar un mensaje en inglés a tal
			dirección y/o por ejemplo a las cuentas
			<TT
CLASS="literal"
>webmaster</TT
> y <TT
CLASS="literal"
>root</TT
>
			informando sobre el incidente con un tema como:
			<PRE
CLASS="screen"
>&#13;Attempt to login at practica.pasosdeJesus.org from your IP on 16.Aug.2006 at 7:10:41
			</PRE
>
		</P
></LI
></OL
>

		</P
><DIV
CLASS="sect2"
><H2
CLASS="sect2"
><A
NAME="lr-bitacoras"
>Lecturas recomendadas</A
></H2
><P
>&#13;		  <P
></P
><UL
><LI
><P
>&#13;		  Todas las herramientas mencionadas <B
CLASS="command"
>less</B
>, 
		  <B
CLASS="command"
>find</B
>, <B
CLASS="command"
>grep</B
>, 
		  <B
CLASS="command"
>wc</B
> tienen sus respectivos manuales, 
		  los cuales se pueden consultar con <B
CLASS="command"
>man</B
>,
		  por ejemplo
		  <PRE
CLASS="screen"
>&#13;man grep 
		  </PRE
>
				  </P
></LI
></UL
>
	  </P
></DIV
></DIV
><DIV
CLASS="NAVFOOTER"
><HR
ALIGN="LEFT"
WIDTH="100%"><TABLE
SUMMARY="Footer navigation table"
WIDTH="100%"
BORDER="0"
CELLPADDING="0"
CELLSPACING="0"
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
><A
HREF="x1661.htm"
ACCESSKEY="P"
>Anterior</A
></TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
><A
HREF="t1.htm"
ACCESSKEY="H"
>Inicio</A
></TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
><A
HREF="a1852.htm"
ACCESSKEY="N"
>Siguiente</A
></TD
></TR
><TR
><TD
WIDTH="33%"
ALIGN="left"
VALIGN="top"
>Labores básicas de administración</TD
><TD
WIDTH="34%"
ALIGN="center"
VALIGN="top"
>&nbsp;</TD
><TD
WIDTH="33%"
ALIGN="right"
VALIGN="top"
>Novedades</TD
></TR
></TABLE
></DIV
></BODY
></HTML
>